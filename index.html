<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dxhmine's 资源中心</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://fastlist-css.pages.dev/css2.css">
  <link rel="stylesheet" href="https://fastlist-css.pages.dev/css.css">
  <style>
    /* css */
    /* 固定顶部栏样式 */
    .fixed-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--surface);
      box-shadow: var(--elevation-2);
      padding: var(--spacing-sm) var(--spacing-lg);
      z-index: 999;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: var(--spacing-md);
      min-height: 60px;
      overflow-x: auto;
      white-space: nowrap;
      box-sizing: border-box;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .fixed-header::-webkit-scrollbar {
      display: none;
    }
    
    /* 标题样式 */
    .header-title {
      font-size: 1.2rem;
      font-weight: bold;
      flex-shrink: 0;
      margin: 0;
    }
    
    /* 搜索栏样式 - 自适应宽度 */
    .search-container {
      flex: 1;
      min-width: 200px;
      max-width: 500px;
    }
    
    /* 容器样式 - 移除margin-top避免与body的padding-top冲突 */
    .container {
      padding-top: var(--spacing-lg); /* 只保留内边距，提升视觉效果 */
    }
    
    /* 公告按钮样式 */
    .announcement-btn {
      margin-left: 0;
      padding: 4px 10px;
      background-color: var(--primary);
      color: var(--on-primary);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: var(--transition);
      flex-shrink: 0;
    }
    
    /* 主题按钮样式 */
    .theme-btn {
      margin-left: 0;
      padding: 4px 10px;
      background-color: var(--secondary);
      color: var(--on-secondary);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      cursor: pointer;
      transition: var(--transition);
      flex-shrink: 0;
    }
    
    .theme-btn:hover {
      background-color: var(--secondary-container);
      color: var(--on-secondary-container);
    }
    
    /* 主题展示弹窗样式 */
    .theme-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--elevation-3);
      padding: var(--spacing-lg);
      z-index: 1001;
      display: none;
      flex-direction: column;
      align-items: center;
      max-width: 90vw;
      max-height: 90vh;
    }
    
    .theme-modal.show {
      display: flex;
    }
    
    .theme-image {
      max-width: 100%;
      max-height: 70vh;
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-md);
    }
    
    .theme-caption {
      font-size: 1.1rem;
      color: var(--on-surface);
      text-align: center;
      font-weight: 500;
    }
    
    .theme-close {
      position: absolute;
      top: var(--spacing-md);
      right: var(--spacing-md);
      background: none;
      border: none;
      color: var(--outline);
      cursor: pointer;
      padding: var(--spacing-xs);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .theme-close:hover {
      background-color: var(--outline-variant);
      color: var(--on-surface);
    }
    
    .announcement-btn:hover {
      background-color: var(--primary-container);
      color: var(--on-primary-container);
    }
    
    /* 公告模态窗口样式 */
    .announcement-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--surface);
      border-radius: var(--radius-lg);
      box-shadow: var(--elevation-3);
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow: hidden;
      z-index: 1000;
      display: none;
      flex-direction: column;
    }
    
    .announcement-modal.show {
      display: flex;
    }
    
    .announcement-modal-header {
      padding: var(--spacing-md) var(--spacing-lg);
      border-bottom: 1px solid var(--outline-variant);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .announcement-modal-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--on-surface);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .announcement-modal-close {
      background: none;
      border: none;
      color: var(--outline);
      cursor: pointer;
      padding: var(--spacing-xs);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .announcement-modal-close:hover {
      background-color: var(--outline-variant);
      color: var(--on-surface);
    }
    
    .announcement-modal-body {
      padding: var(--spacing-md) var(--spacing-lg);
      overflow-y: auto;
      flex: 1;
    }
    
    .announcement-modal-footer {
      padding: var(--spacing-md) var(--spacing-lg);
      border-top: 1px solid var(--outline-variant);
      display: flex;
      justify-content: flex-end;
      gap: var(--spacing-sm);
    }
    
    /* 模态窗口背景遮罩 */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
      display: none;
    }
    
    .modal-backdrop.show {
      display: block;
    }
    

    
    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--primary);
      white-space: nowrap;
    }
    
    .header-theme-switcher {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      padding: 4px 8px;
      border-radius: var(--radius-md);
      background-color: var(--surface-variant);
      flex-shrink: 0;
    }
    
    .theme-text {
      font-size: 0.95rem;
      color: var(--on-surface);
      white-space: nowrap;
      font-weight: 500;
    }
    
    @media (max-width: 768px) {
      /* 移动端顶部按钮行样式 */
      .header-buttons {
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 2px;
        gap: 4px;
      }
      
      /* 移动端内容区域样式 */
      .header-content {
        flex-direction: column;
        align-items: stretch;
        gap: 4px;
        margin-bottom: 0;
      }
      
      .search-container {
        width: 100%;
      }
      
      .header-theme-switcher {
        gap: var(--spacing-sm);
        justify-content: center;
      }
      
      .theme-text {
        font-size: 0.9rem;
      }
    }
    
    /* 搜索功能样式 */
    .search-container {
      position: relative;
      flex: 1;
      min-width: 200px;
      max-width: 600px;
    }
    
    .search-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .search-icon {
      position: absolute;
      left: var(--spacing-md);
      color: var(--outline);
      z-index: 1;
    }
    
    .search-input {
      width: 100%;
      padding: var(--spacing-md) var(--spacing-lg) var(--spacing-md) calc(var(--spacing-md) * 3);
      background-color: var(--surface-variant);
      border: none;
      border-radius: var(--radius-md);
      font-size: 16px;
      color: var(--on-surface);
      transition: var(--transition);
    }
    
    .search-input:focus {
      outline: none;
      background-color: var(--surface);
      box-shadow: 0 0 0 2px var(--primary);
    }
    
    .search-input::placeholder {
      color: var(--outline);
    }
    
    .clear-search-btn {
      position: absolute;
      right: var(--spacing-sm);
      background: none;
      border: none;
      color: var(--outline);
      cursor: pointer;
      padding: var(--spacing-xs);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .clear-search-btn:hover {
      background-color: var(--outline-variant);
      color: var(--on-surface);
    }
    
    .search-results-count {
      font-size: 14px;
      color: var(--outline);
      margin-top: var(--spacing-xs);
      text-align: right;
    }
    
    /* 为了防止内容被固定头部和次级栏遮挡，添加足够大的padding-top */
    body {
      padding-top: 1500px; /* 增加到足够大的值，确保统计控件完全可见 */
    }
    
    @media (max-width: 768px) {
      body {
        padding-top: 1700px; /* 移动端设置更大的padding-top */
      }
    }
    
    /* 公告栏容器样式 - 隐藏原有公告栏 */
    .announcement-container {
      max-width: var(--container-width, 1200px);
      margin: 0 auto;
      padding: 0 var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      position: relative;
      z-index: 100;
      display: none; /* 隐藏原有公告栏，使用顶部按钮显示 */
    }
    
    /* 搜索结果中匹配的文本高亮 */
    .highlight {
      background-color: rgba(255, 230, 0, 0.3);
      font-weight: bold;
      color: var(--on-background);
      padding: 0 2px;
      border-radius: 2px;
    }
    
    /* 无搜索结果提示 */
    .no-results {
      text-align: center;
      padding: var(--spacing-xl);
      color: var(--outline);
    }
    
    .no-results i {
      font-size: 32px;
      margin-bottom: var(--spacing-md);
      display: block;
    }
    
    /* 搜索结果中的分类标题 */
    .search-result-category {
      background-color: var(--primary-container);
      color: var(--on-primary-container);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      margin-top: var(--spacing-lg);
      font-weight: 600;
      font-size: 14px;
    }
    
    :root {
      --primary: #0067C0;
      --on-primary: #FFFFFF;
      --primary-container: #D3E5FF;
      --on-primary-container: #001D36;
      
      --secondary: #535F70;
      --on-secondary: #FFFFFF;
      --secondary-container: #D7E3F7;
      --on-secondary-container: #101C2B;
      
      --surface: #F9F9FA;
      --on-surface: #1A1C1E;
      --surface-variant: #DFE2EB;
      --on-surface-variant: #43474E;
      
      --background: #F9F9FA;
      --on-background: #1A1C1E;
      
      --outline: #74777F;
      --outline-variant: #C4C6D0;
      
      --error: #BA1A1A;
      --on-error: #FFFFFF;
      --error-container: #FFDAD6;
      --on-error-container: #410002;
      
      --success: #0C7D60;
      --on-success: #FFFFFF;
      --success-container: #A6F2DB;
      --on-success-container: #002116;
      
      --warning: #E6B400;
      --on-warning: #FFFFFF;
      --warning-container: #FFE9A3;
      --on-warning-container: #4C3D00;
      
      --elevation-1: 0 1px 2px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
      --elevation-2: 0 2px 6px rgba(0, 0, 0, 0.05), 0 3px 6px rgba(0, 0, 0, 0.1);
      --elevation-3: 0 4px 12px rgba(0, 0, 0, 0.05), 0 6px 12px rgba(0, 0, 0, 0.1);
      
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-xl: 18px;
      --radius-xxl: 28px;
      
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --spacing-xxl: 48px;
      
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      
      --icon-size-sm: 18px;
      --icon-size-md: 24px;
      --icon-size-lg: 32px;
    }

    /* 暗色主题 */
    [data-theme="dark"] {
      --primary: #A8C8FF;
      --on-primary: #003059;
      --primary-container: #00497E;
      --on-primary-container: #D3E5FF;
      
      --secondary: #BBC7DB;
      --on-secondary: #253140;
      --secondary-container: #3B4858;
      --on-secondary-container: #D7E3F7;
      
      --surface: #121316;
      --on-surface: #E2E2E5;
      --surface-variant: #43474E;
      --on-surface-variant: #C4C6D0;
      
      --background: #121316;
      --on-background: #E2E2E5;
      
      --outline: #8E9199;
      --outline-variant: #43474E;
      
      --error: #FFB4AB;
      --on-error: #690005;
      --error-container: #93000A;
      --on-error-container: #FFDAD6;
      
      --success: #88D8BF;
      --on-success: #00382A;
      --success-container: #00503F;
      --on-success-container: #A6F2DB;
      
      --warning: #FFDC48;
      --on-warning: #3D3000;
      --warning-container: #5F4E00;
      --on-warning-container: #FFE9A3;
      
      --elevation-1: 0 1px 2px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.3);
      --elevation-2: 0 2px 6px rgba(0, 0, 0, 0.2), 0 3px 6px rgba(0, 0, 0, 0.3);
      --elevation-3: 0 4px 12px rgba(0, 0, 0, 0.2), 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', 'Segoe UI', system-ui, sans-serif;
      transition: background-color var(--transition), color var(--transition), border-color var(--transition);
    }
    
    body {
      background-color: var(--background);
      color: var(--on-background);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      line-height: 1.5;
      padding: var(--spacing-md);
    }
    
    .container {
      max-width: 1300px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
      padding-bottom: var(--spacing-xl);
    }

    @media (min-width: 768px) {
      .container {
        grid-template-columns: 1.2fr 0.8fr;
      }
    }

    header {
      grid-column: 1 / -1;
      text-align: center;
      margin: var(--spacing-xl) 0;
      position: relative;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
    }

    .logo-icon {
      background: var(--primary);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon i {
      font-size: 28px;
      color: var(--on-primary);
    }

    h1 {
      color: var(--primary);
      font-size: 2.5rem;
      margin-bottom: var(--spacing-sm);
    }

    .theme-switcher {
      position: fixed;
      top: var(--spacing-md);
      right: var(--spacing-md);
      z-index: 1000;
      display: flex;
      gap: var(--spacing-sm);
    }

    .theme-toggle {
      position: relative;
      width: 48px;
      height: 24px;
      background: var(--surface-variant);
      border-radius: var(--radius-xxl);
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 2px;
      transition: background-color var(--transition);
    }
    
    .theme-toggle::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--primary);
      left: 2px;
      transition: transform var(--transition);
    }
    
    [data-theme="dark"] .theme-toggle::before {
      transform: translateX(24px);
    }
    
    .theme-icon {
      position: relative;
      z-index: 1;
      font-size: var(--icon-size-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      width: 20px;
      height: 20px;
      color: var(--on-primary);
    }
    
    .light-icon {
      opacity: 1;
      transition: opacity var(--transition);
    }
    
    .dark-icon {
      opacity: 0;
      transition: opacity var(--transition);
    }
    
    [data-theme="dark"] .light-icon {
      opacity: 0;
    }
    
    [data-theme="dark"] .dark-icon {
      opacity: 1;
    }

    .card {
      background: var(--surface);
      border-radius: var(--radius-xl);
      box-shadow: var(--elevation-1);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
      transition: box-shadow var(--transition), transform var(--transition);
    }
    
    .card:hover {
      box-shadow: var(--elevation-2);
    }

    .announcement-section {
      grid-column: 1 / -1;
      background: var(--warning-container);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      margin-bottom: var(--spacing-md);
    }

    .announcement-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-md);
    }

    .announcement-title {
      color: var(--on-warning-container);
      margin: 0;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .refresh-button {
      background: rgba(255, 255, 255, 0.3);
      border: 1px solid var(--on-warning-container);
      color: var(--on-warning-container);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .refresh-button:hover {
      background: var(--on-warning-container);
      color: var(--warning-container);
    }

    .section-title {
      color: var(--primary);
      padding-bottom: var(--spacing-md);
      margin-top: 0;
      margin-bottom: var(--spacing-lg);
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      border-bottom: 1px solid var(--outline-variant);
    }

    .section-title i {
      font-size: 1.4rem;
    }

    .release {
      background-color: var(--surface-variant);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--radius-lg);
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .release-header h3 {
      color: var(--primary);
      margin-bottom: var(--spacing-sm);
      font-size: 1.3rem;
    }

    .release-meta {
      display: flex;
      gap: var(--spacing-lg);
      color: var(--on-surface-variant);
      margin-bottom: var(--spacing-md);
      font-size: 0.95rem;
    }

    .download-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-md);
      margin: var(--spacing-sm) 0;
      background: var(--surface);
      border-radius: var(--radius-md);
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .download-item:hover {
      transform: translateX(5px);
      border-left: 4px solid var(--primary);
    }

    .file-info {
      flex: 1;
    }

    .file-name {
      font-weight: 600;
      display: block;
      margin-bottom: var(--spacing-xs);
      font-size: 1.1rem;
      color: var(--primary);
    }

    .file-size {
      color: var(--on-surface-variant);
      font-size: 0.9rem;
    }

    .download-options {
      display: flex;
      gap: var(--spacing-sm);
    }

    .download-link {
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: var(--radius-sm);
      text-decoration: none;
      transition: var(--transition);
      font-size: 0.95rem;
      font-weight: 500;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .download-link:not(.accelerated) {
      background: var(--surface-variant);
      color: var(--on-surface-variant);
      border: 1px solid var(--outline-variant);
    }

    .download-link:not(.accelerated):hover {
      background: var(--outline-variant);
    }

    .download-link.accelerated {
      background: var(--primary);
      color: var(--on-primary);
      border: 1px solid var(--primary);
    }

    .download-link.accelerated:hover {
      opacity: 0.9;
    }

    .toggle-assets {
      background: var(--primary);
      color: var(--on-primary);
      padding: var(--spacing-sm) var(--spacing-md);
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: var(--transition);
      margin-top: var(--spacing-md);
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }

    .toggle-assets:hover {
      opacity: 0.9;
    }

    .quick-create {
      background: var(--surface-variant);
      padding: var(--spacing-lg);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
      border: 1px solid var(--outline-variant);
      transition: var(--transition);
    }

    .form-input, .form-textarea {
      width: 100%;
      padding: var(--spacing-md);
      margin: var(--spacing-sm) 0;
      border: 1px solid var(--outline-variant);
      border-radius: var(--radius-md);
      box-sizing: border-box;
      font-family: inherit;
      transition: var(--transition);
      font-size: 1rem;
      background: var(--surface);
      color: var(--on-surface);
    }

    .form-input:focus, .form-textarea:focus {
      border-color: var(--primary);
      outline: none;
    }

    .submit-button {
      background: var(--primary);
      color: var(--on-primary);
      padding: var(--spacing-md) var(--spacing-lg);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-family: inherit;
      font-weight: 600;
      transition: var(--transition);
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-xs);
      margin-top: var(--spacing-sm);
    }

    .submit-button:hover {
      opacity: 0.9;
    }

    .issue {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-lg);
      background: var(--surface);
      border: 1px solid var(--outline-variant);
      border-radius: var(--radius-lg);
      transition: var(--transition);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-md);
    }

    .avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary);
      padding: 2px;
    }

    .comment {
      margin: var(--spacing-lg) 0;
      padding: var(--spacing-lg);
      background: var(--surface-variant);
      border-radius: var(--radius-md);
      display: flex;
      gap: var(--spacing-lg);
      transition: var(--transition);
      border: 1px solid var(--outline-variant);
    }

    .comment:hover {
      transform: translateX(5px);
      border-left: 3px solid var(--primary);
    }

    .comment-content {
      flex-grow: 1;
    }

    .comment-author {
      font-weight: 600;
      color: var(--primary);
      font-size: 1.1rem;
    }

    .comment-date {
      color: var(--on-surface-variant);
      font-size: 0.85rem;
      margin-top: 3px;
    }

    .comments-container {
      margin-top: var(--spacing-lg);
      border-top: 1px solid var(--outline-variant);
      padding-top: var(--spacing-lg);
    }

    .disclaimer-section {
      grid-column: 1 / -1;
      margin-top: var(--spacing-xl);
      padding: var(--spacing-lg);
      background: var(--surface-variant);
      border-radius: var(--radius-lg);
      border: 1px solid var(--outline-variant);
      font-size: 0.95rem;
      color: var(--on-surface-variant);
      text-align: center;
    }

    .disclaimer-link {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
      border-bottom: 1px dashed var(--primary);
    }

    .disclaimer-link:hover {
      border-bottom-style: solid;
    }

    .loading-text {
      text-align: center;
      color: var(--on-surface-variant);
      padding: var(--spacing-xl);
      font-size: 1.1rem;
    }

    .loading-text i {
      margin-right: var(--spacing-sm);
      animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .stats-bar {
      display: flex;
      justify-content: space-around;
      padding: var(--spacing-md);
      background: var(--surface);
      border-radius: var(--radius-lg);
      margin: var(--spacing-lg) 0;
      grid-column: 1 / -1;
      border: 1px solid var(--outline-variant);
    }

    .stat-item {
      text-align: center;
      padding: var(--spacing-sm);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: var(--spacing-xs);
    }

    .stat-label {
      color: var(--on-surface-variant);
      font-size: 0.95rem;
    }

    .footer {
      grid-column: 1 / -1;
      text-align: center;
      padding: var(--spacing-lg);
      margin-top: var(--spacing-lg);
      color: var(--on-surface-variant);
      font-size: 0.9rem;
      border-top: 1px solid var(--outline-variant);
    }

    /* 新增样式 */
    .github-stats {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--spacing-md);
      margin-top: var(--spacing-sm);
    }
    
    .github-stat {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
      color: var(--on-surface-variant);
      font-size: 0.95rem;
    }
    
    .github-stat i {
      color: var(--primary);
    }
    
    .release-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    .release-category {
      background: var(--surface-variant);
      border-radius: var(--radius-lg);
      border: 1px solid var(--outline-variant);
      margin-bottom: var(--spacing-lg);
      overflow: hidden;
    }
    
    .category-header {
      background: var(--primary-container);
      color: var(--on-primary-container);
      padding: var(--spacing-md) var(--spacing-lg);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
      font-weight: 600;
    }
    
    .category-header:hover {
      background: var(--primary);
      color: var(--on-primary);
    }
    
    .category-content {
      padding: 0;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out, padding 0.3s ease;
    }
    
    .category-content.expanded {
      padding: var(--spacing-md);
      max-height: 5000px;
      transition: max-height 0.8s ease-in, padding 0.3s ease;
    }
    
    .category-count {
      background: var(--surface);
      color: var(--on-surface);
      padding: 2px 8px;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .default-category {
      background: var(--surface);
    }
    
    .default-category .category-header {
      background: var(--secondary-container);
      color: var(--on-secondary-container);
    }
    
    .default-category .category-header:hover {
      background: var(--secondary);
      color: var(--on-secondary);
    }
    
    .discussion-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    @media (min-width: 768px) {
      .release-grid {
        grid-template-columns: 1fr;
      }
      
      .discussion-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      body {
        padding: var(--spacing-sm);
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .section-title {
        font-size: 1.5rem;
      }
      
      .download-item {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--spacing-md);
      }

      .download-options {
        width: 100%;
        flex-direction: column;
      }
      
      .download-link {
        width: 100%;
        text-align: center;
        justify-content: center;
      }
      
      .stats-bar {
        flex-direction: column;
        gap: var(--spacing-md);
      }
      
      /* 移动端顶部栏响应式适配 */
      @media (max-width: 768px) {
        .fixed-header {
          padding: var(--spacing-xs) var(--spacing-sm);
          gap: var(--spacing-sm);
          min-height: 50px;
        }
        
        .header-title {
          font-size: 1rem;
        }
        
        .search-container {
          min-width: 150px;
          max-width: none;
        }
      }
      
      @media (max-width: 480px) {
        .fixed-header {
          gap: var(--spacing-xs);
          padding: var(--spacing-xs);
        }
        
        .header-title {
          font-size: 0.9rem;
        }
        
        .search-container {
          min-width: 120px;
        }
      }
      
      /* 按钮和主题切换器样式 */
      .announcement-btn, .theme-btn {
        flex-shrink: 0;
        padding: var(--spacing-xs) var(--spacing-sm);
        margin: 0;
      }
      
      .header-theme-switcher {
        flex-shrink: 0;
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }
      
      /* 确保内容不会超出屏幕 */
      body {
        overflow-x: hidden;
      }
      }
      
      .search-input-wrapper {
        display: flex;
        align-items: center;
        width: 100%;
      }
      
      .search-input {
        flex: 1;
        padding: 8px 36px 8px 10px;
        font-size: 0.8rem;
        width: 100%;
        height: 34px;
        box-sizing: border-box;
      }
      
      .search-button {
        position: absolute;
        right: 6px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 0.8rem;
        height: 28px;
        width: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      /* 按钮移动端样式 */
      .theme-btn {
        margin-left: 0;
        padding: 6px 12px;
        font-size: 0.75rem;
        min-width: 60px;
        text-align: center;
        border-radius: var(--radius-sm);
        flex-shrink: 0;
      }
      
      /* 公告按钮移动端样式 */
      .announcement-btn {
        margin-left: var(--spacing-xs);
        padding: 6px 10px;
        font-size: 0.75rem;
        flex-shrink: 0;
      }
      
      /* 主题切换器移动端样式 */
      .header-theme-switcher {
        display: flex;
        align-items: center;
        gap: 4px;
        margin-left: auto;
        flex-shrink: 0;
      }
      
      .theme-text {
        font-size: 0.75rem;
        white-space: nowrap;
      }
      
      .theme-toggle {
        width: 36px;
        height: 18px;
        padding: 1px;
      }
      
      .theme-toggle::before {
        width: 14px;
        height: 14px;
        left: 2px;
      }
      
      [data-theme="dark"] .theme-toggle::before {
        transform: translateX(18px);
      }
      
      /* 图标大小调整 */
      .theme-icon i {
        font-size: 12px;
      }
      
      /* 确保图标在切换器中正确显示 */
      .theme-toggle .theme-icon {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        font-size: 12px;
        pointer-events: none;
      }
      
      .light-icon {
        left: 3px;
        color: var(--on-primary);
      }
      
      .dark-icon {
        right: 3px;
        color: var(--on-primary);
      }
  </style>
</head>
<body>
  <div class="fixed-header">
    <div class="header-title">资源中心</div>
    <div class="search-container">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="search-input"
               placeholder="搜索文件名或分类..."
               class="search-input">
        <button id="clear-search" class="clear-search-btn" style="display:none;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="search-results-count" class="search-results-count"></div>
    </div>
    <button id="announcement-button" class="announcement-btn" onclick="toggleAnnouncement()"><i class="fas fa-bullhorn"></i> 公告</button>
    <button id="theme-button" class="theme-btn" onclick="showRandomTheme()">click it!</button>
    <div class="header-theme-switcher">
      <span class="theme-text">深色模式</span>
      <div class="theme-toggle" onclick="toggleTheme()">
        <span class="theme-icon light-icon"><i class="fas fa-sun"></i></span>
        <span class="theme-icon dark-icon"><i class="fas fa-moon"></i></span>
      </div>
    </div>
  </div>
  

  
  <!-- 保留原主题切换器但默认隐藏，以防JavaScript失败时仍有后备方案 -->
  <div class="theme-switcher" style="display:none;">
    <div class="theme-toggle" onclick="toggleTheme()">
      <span class="theme-icon light-icon"><i class="fas fa-sun"></i></span>
      <span class="theme-icon dark-icon"><i class="fas fa-moon"></i></span>
    </div>
  </div>
  
  <!-- 主题展示弹窗 -->
  <div class="theme-modal" id="theme-modal">
    <button class="theme-close" onclick="hideThemeModal()">
      <i class="fas fa-times"></i>
    </button>
    <img class="theme-image" id="theme-image" src="" alt="随机主题图片">
    <p class="theme-caption" id="theme-caption">今日伴侣：</p>
  </div>
  <div class="modal-backdrop" id="theme-backdrop"></div>

  <!-- header区域已移除，内容已整合到顶部栏下方的子栏中 -->
  
  <!-- 公告栏移到container外部，确保它位于顶部栏和子栏下方且不会被遮挡 -->
  <div class="announcement-container">
    <div class="announcement-section card">
      <div class="announcement-header">
        <h2 class="announcement-title"><i class="fas fa-bullhorn"></i> 公告</h2>
        <button class="refresh-button" onclick="fetchAnnouncement()">
          <i class="fas fa-sync-alt"></i> 刷新
        </button>
      </div>
      <div id="announcement-content">
        <div class="loading-text"><i class="fas fa-spinner"></i> 加载公告中...</div>
      </div>
    </div>
  </div>
  
  <div class="container">

    <div class="stats-bar card">
      <div class="stat-item">
        <div class="stat-value" id="release-count">0</div>
        <div class="stat-label">资源发布</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="file-count">0</div>
        <div class="stat-label">文件总数</div>
      </div>
      <div class="stat-item">
        <div class="stat-value" id="user-count">0</div>
        <div class="stat-label">GitHub Stars</div>
      </div>
    </div>

    <div class="card">
      <h2 class="section-title"><i class="fas fa-box-open"></i> 文件发布</h2>
      <!-- 搜索结果区域 -->
      <!-- 原始内容显示区域 -->
      <div id="original-content">
        <div class="release-grid" id="releases">
          <div class="loading-text"><i class="fas fa-spinner"></i> 加载发布文件中...</div>
        </div>
      </div>
      <!-- 搜索结果显示区域 -->
      <div id="search-results" class="release-grid" style="display:none;">
      </div>
    </div>

    <div class="card">
      <h2 class="section-title"><i class="fas fa-comments"></i> 社区讨论</h2>
      <div class="discussion-grid">
        <div class="quick-create">
          <h3 style="margin-top:0; color: var(--primary);"><i class="fas fa-pen"></i> 新建讨论</h3>
          <input type="text" id="issueTitle" 
                 placeholder="输入讨论标题（必填）" 
                 class="form-input"
                 required>
          <textarea id="issueBody" 
                    class="form-textarea"
                    placeholder="输入讨论内容（支持Markdown格式）"
                    rows="4"></textarea>
          <button onclick="createNewIssue()" 
                  class="submit-button">
            <i class="fas fa-plus-circle"></i> 创建讨论
          </button>
        </div>
        <div id="discussions">
          <div class="loading-text"><i class="fas fa-spinner"></i> 加载讨论中...</div>
        </div>
      </div>
    </div>

    <section class="disclaimer-section card">
      <strong><i class="fas fa-exclamation-circle"></i> 免责声明：</strong>
      本站所有资源均为来自于网络，不代表本站立场。下载内容仅供学习交流使用，不得用于商业用途。 
      一切后果由使用者自行承担

    </section>
    
    <div class="footer">
      <p>© 2025 YF-Cloud</p>
    </div>
  </div>

  <script>
    // 新增主题功能
    function toggleTheme() {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }

    function initTheme() {
      const savedTheme = localStorage.getItem('theme') || 
                        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.body.setAttribute('data-theme', savedTheme);
    }
    


    // 获取GitHub仓库信息
    async function fetchGitHubStats() {
      try {
        const response = await fetch('https://api.github.com/repos/Dxhmine/test');
        if (!response.ok) throw new Error('获取GitHub信息失败');
        
        const data = await response.json();
        // 只设置我们确定存在的元素
        const userCountElement = document.getElementById('user-count');
        if (userCountElement) {
          userCountElement.textContent = data.stargazers_count;
        }
        
        // 对于其他可能不存在的元素，添加null检查
        const githubStarsElement = document.getElementById('github-stars');
        const githubForksElement = document.getElementById('github-forks');
        
        if (githubStarsElement) {
          githubStarsElement.textContent = data.stargazers_count;
        }
        
        if (githubForksElement) {
          githubForksElement.textContent = data.forks_count;
        }
      } catch (error) {
        console.error('获取GitHub数据失败:', error);
        // 添加null检查以避免错误
        const userCountElement = document.getElementById('user-count');
        if (userCountElement) {
          userCountElement.textContent = 'N/A';
        }
        
        const githubStarsElement = document.getElementById('github-stars');
        if (githubStarsElement) {
          githubStarsElement.textContent = 'N/A';
        }
        
        const githubForksElement = document.getElementById('github-forks');
        if (githubForksElement) {
          githubForksElement.textContent = 'N/A';
        }
      }
    }

    async function initialize() {
      initTheme();
      try {
        await Promise.all([
          fetchReleases(),
          fetchDiscussions(),
          fetchGitHubStats()
        ]);
        // 不再自动加载原公告栏内容，因为它将被隐藏
      } catch (error) {
        showErrorNotification(`初始化失败: ${error.message}`);
      }
    }

    // 获取GitHub仓库themes文件夹中的图片列表
    async function getThemeImages() {
      try {
        console.log('开始检测GitHub仓库themes文件夹中的图片');
        
        // 添加操作超时控制
        const timeoutPromise = new Promise((_, reject) => {
          setTimeout(() => reject(new Error('获取图片列表超时')), 8000);
        });
        
        // 使用Promise.race实现超时控制
        return await Promise.race([
          (async () => {
            // 尝试通过GitHub API获取仓库内容
            const repoUrl = 'https://api.github.com/repos/Dxhmine/test/contents/themes';
            const response = await fetch(repoUrl, {
              method: 'GET',
              headers: {
                'Accept': 'application/vnd.github.v3+json'
              }
            });
            
            // 检查响应状态
            if (!response || !response.ok) {
              const errorMsg = response ? `GitHub API返回状态码: ${response.status}` : '无法连接到GitHub API';
              console.log(errorMsg + '，尝试备用方法检测图片');
              return await detectImagesByCommonPatterns();
            }
            
            // 尝试解析JSON
            let items;
            try {
              items = await response.json();
            } catch (jsonError) {
              console.error('解析GitHub API响应失败:', jsonError);
              console.log('尝试备用方法检测图片');
              return await detectImagesByCommonPatterns();
            }
            
            // 检查解析结果
            if (!Array.isArray(items)) {
              console.error('GitHub API返回的不是数组格式:', items);
              console.log('尝试备用方法检测图片');
              return await detectImagesByCommonPatterns();
            }
            
            // 过滤出图片文件
            const imageFiles = items
              .filter(item => item && item.type === 'file' && 
                /\.(jpg|jpeg|png|gif|webp|bmp|svg)$/i.test(item.name))
              .map(item => item.name);
            
            console.log('通过GitHub API检测到的图片:', imageFiles);
            return imageFiles.length > 0 ? imageFiles : ['image1.png'];
          })(),
          timeoutPromise
        ]);
      } catch (error) {
        console.error('获取主题图片列表失败:', error);
        // 出错时尝试备用方法
        try {
          return await detectImagesByCommonPatterns();
        } catch (backupError) {
          console.error('备用方法也失败:', backupError);
          return ['image1.png']; // 所有方法都失败时返回默认图片
        }
      }
    }
    
    // 备用方法：通过常见命名模式检测图片
    async function detectImagesByCommonPatterns() {
      try {
        // 定义常见的图片命名模式
        const commonPatterns = [
          // 常见的基础命名
          'theme', 'background', 'wallpaper', 'banner', 'cover', 'header',
          // 数字序列
          '1', '2', '3', '4', '5', '6', '7', '8', '9', '10',
          // 之前使用过的命名
          'image1'
        ];
        
        // 常见的图片扩展名
        const extensions = ['png', 'jpg', 'jpeg', 'gif', 'webp'];
        
        // 生成可能的文件名组合
        const possibleImages = [];
        for (const pattern of commonPatterns) {
          for (const ext of extensions) {
            possibleImages.push(`${pattern}.${ext}`);
          }
        }
        
        console.log('准备检测的可能图片文件数量:', possibleImages.length);
        
        // 添加超时控制
        const timeoutPromise = new Promise((_, reject) => {
          setTimeout(() => reject(new Error('图片检测超时')), 10000);
        });
        
        // 使用Promise.race实现超时控制
        return await Promise.race([
          (async () => {
            // 使用HEAD请求并行检查每个图片是否存在，但限制并发数
            const concurrencyLimit = 5;
            const validImages = [];
            
            // 分批执行请求
            for (let i = 0; i < possibleImages.length; i += concurrencyLimit) {
              const batch = possibleImages.slice(i, i + concurrencyLimit);
              const checkPromises = batch.map(async (filename) => {
                try {
                  // 验证filename是有效的字符串
                  if (typeof filename !== 'string' || !filename.trim()) {
                    return null;
                  }
                  
                  const imageUrl = `https://raw.githubusercontent.com/Dxhmine/test/main/themes/${encodeURIComponent(filename.trim())}`;
                  const controller = new AbortController();
                  const timeoutId = setTimeout(() => controller.abort(), 3000); // 单个请求3秒超时
                  
                  const response = await fetch(imageUrl, { 
                    method: 'HEAD',
                    signal: controller.signal,
                    headers: {
                      'Accept': 'image/*'
                    }
                  });
                  
                  clearTimeout(timeoutId);
                  return response.ok ? filename : null;
                } catch (error) {
                  // 忽略单个请求错误
                  return null;
                }
              });
              
              const batchResults = await Promise.all(checkPromises);
              validImages.push(...batchResults.filter(filename => filename !== null));
            }
            
            console.log('通过备用方法检测到的图片:', validImages);
            return validImages.length > 0 ? validImages : ['image1.png'];
          })(),
          timeoutPromise
        ]);
      } catch (error) {
        console.error('备用图片检测方法失败:', error);
        return ['image1.png'];
      }
    }
    
    // 每日刷新图片功能
    function shouldRefreshImage() {
      try {
        const storedData = localStorage.getItem('themeImageData');
        if (!storedData) return true; // 没有存储数据，需要刷新
        
        const { lastDate, imageName } = JSON.parse(storedData);
        const today = new Date().toDateString();
        
        // 检查日期是否变更
        if (lastDate !== today) {
          console.log('日期变更，需要刷新图片');
          return true;
        }
        
        console.log('今日已显示过图片，使用缓存的图片:', imageName);
        return false;
      } catch (error) {
        console.error('检查图片刷新状态失败:', error);
        return true; // 出错时默认刷新
      }
    }
    
    // 获取今日缓存的图片信息
    function getCachedImageInfo() {
      try {
        const storedData = localStorage.getItem('themeImageData');
        if (!storedData) return null;
        
        const { lastDate, imageName, imageUrl } = JSON.parse(storedData);
        const today = new Date().toDateString();
        
        // 只返回今天的缓存信息
        return lastDate === today ? { imageName, imageUrl } : null;
      } catch (error) {
        console.error('获取缓存图片信息失败:', error);
        return null;
      }
    }
    
    // 缓存今日图片信息
    function cacheImageInfo(imageName, imageUrl) {
      try {
        const today = new Date().toDateString();
        const data = {
          lastDate: today,
          imageName: imageName,
          imageUrl: imageUrl
        };
        localStorage.setItem('themeImageData', JSON.stringify(data));
        console.log('图片信息已缓存');
      } catch (error) {
        console.error('缓存图片信息失败:', error);
      }
    }
    
    // 显示随机主题图片
    async function showRandomTheme() {
      // 验证DOM元素是否存在
      const modal = document.getElementById('theme-modal');
      const backdrop = document.getElementById('theme-backdrop');
      const imgElement = document.getElementById('theme-image');
      const captionElement = document.getElementById('theme-caption');
      
      // 安全检查：确保所有必要的DOM元素都存在
      if (!modal || !backdrop || !imgElement || !captionElement) {
        console.error('主题弹窗的必要DOM元素不存在');
        alert('主题功能初始化失败，请刷新页面重试');
        return;
      }
      
      // 显示弹窗和背景
      modal.classList.add('show');
      backdrop.classList.add('show');
      
      // 显示初始加载状态
      captionElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在准备主题图片...';
      imgElement.src = ''; // 清空图片源
      imgElement.alt = '主题图片加载中...'; // 更新alt属性
      
      // 检查是否可以使用缓存的图片
      const cachedImage = getCachedImageInfo();
      if (cachedImage && !shouldRefreshImage()) {
        console.log('使用今日缓存的图片:', cachedImage.imageName);
        captionElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在加载今日图片...';
        
        // 创建Promise来处理图片加载，添加超时
        const imageLoadPromise = new Promise((resolve, reject) => {
          imgElement.onerror = function() {
            reject(new Error(`缓存图片加载失败`));
          };
          
          imgElement.onload = function() {
            resolve();
          };
          
          // 更新图片源和alt属性
          imgElement.alt = `今日主题图片: ${cachedImage.imageName}`;
          imgElement.src = cachedImage.imageUrl;
        });
        
        try {
          await imageLoadPromise;
          captionElement.textContent = `今日伴侣：${cachedImage.imageName} (今日已缓存)`;
          console.log('缓存图片加载成功');
          
          // 确保弹窗在最上层
          if (modal.style.zIndex === '' || parseInt(modal.style.zIndex) < 1000) {
            modal.style.zIndex = '1000';
            backdrop.style.zIndex = '999';
          }
          
          return; // 直接返回，不执行后续逻辑
        } catch (error) {
          console.error('缓存图片加载失败，重新获取:', error);
          // 继续执行后续逻辑获取新图片
        }
      }
      
      try {
        // 添加整体操作超时
        let overallTimeoutId;
        const timeoutPromise = new Promise((_, reject) => {
          overallTimeoutId = setTimeout(() => reject(new Error('操作超时')), 60000); // 延长到1分钟超时
        });
        
        // 使用Promise.race实现超时控制
        await Promise.race([
          (async () => {
            // 获取实际存在的图片列表
            captionElement.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在检测可用图片...';
            let themeImages;
            
            try {
              themeImages = await getThemeImages();
              
              // 安全检查：确保返回的是数组
              if (!Array.isArray(themeImages)) {
                throw new Error('图片列表格式错误');
              }
              
              console.log('可用图片列表:', themeImages);
              
              // 如果图片列表为空，抛出错误
              if (themeImages.length === 0) {
                throw new Error('未检测到任何可用图片');
              }
            } catch (fetchError) {
              console.error('获取图片列表失败:', fetchError);
              throw new Error(`获取图片列表失败: ${fetchError.message}`);
            }
            
            // 图片选择逻辑
            let selectedImage;
            
            // 过滤出有效的文件名
            const validImages = themeImages.filter(img => typeof img === 'string' && img.trim());
            
            if (validImages.length === 0) {
              throw new Error('未找到有效图片文件名');
            }
            
            // 根据图片数量选择图片
            if (validImages.length > 1) {
              const randomIndex = Math.floor(Math.random() * validImages.length);
              selectedImage = validImages[randomIndex];
              console.log(`随机选择了图片: ${selectedImage} (索引: ${randomIndex})`);
            } else {
              // 如果只有一张图片，直接使用
              selectedImage = validImages[0];
              console.log(`只有一张可用图片: ${selectedImage}`);
            }
            
            // 安全检查：确保selectedImage是有效的
            if (typeof selectedImage !== 'string' || !selectedImage.trim()) {
              throw new Error('选择的图片文件名无效');
            }
            
            // 显示加载状态
            captionElement.innerHTML = `<i class="fas fa-spinner fa-spin"></i> 正在加载图片 (共${validImages.length}张)...`;
            
            // 构建图片URL（使用encodeURIComponent确保特殊字符正确处理）
            const imageUrl = `https://raw.githubusercontent.com/Dxhmine/test/main/themes/${encodeURIComponent(selectedImage.trim())}`;
            console.log('正在加载图片:', imageUrl);
            
            // 创建Promise来处理图片加载，添加超时
            const imageLoadPromise = new Promise((resolve, reject) => {
              // 清理之前的事件监听器
              imgElement.onerror = null;
              imgElement.onload = null;
              
              // 检测到图片开始加载，清除整体操作超时定时器
              if (overallTimeoutId) {
                clearTimeout(overallTimeoutId);
                console.log('检测到图片开始加载，已停止整体操作超时判定');
              }
              
              const imageLoadTimeout = setTimeout(() => {
                reject(new Error('图片加载超时'));
              }, 60000); // 延长到1分钟图片加载超时
              
              // 设置图片加载错误处理
              imgElement.onerror = function() {
                clearTimeout(imageLoadTimeout);
                reject(new Error(`图片"${selectedImage}"加载失败`));
              };
              
              // 设置图片加载成功处理
              imgElement.onload = function() {
                clearTimeout(imageLoadTimeout);
                resolve();
              };
              
              // 更新图片源和alt属性
              imgElement.alt = `主题图片: ${selectedImage}`;
              imgElement.src = imageUrl;
            });
            
            // 等待图片加载
            await imageLoadPromise;
            
            // 图片加载成功，更新标题
            if (validImages.length > 1) {
              captionElement.textContent = `今日伴侣：${selectedImage} (随机选择自 ${validImages.length} 张图片)`;
            } else {
              captionElement.textContent = `今日伴侣：${selectedImage} (唯一可用图片)`;
            }
            
            // 缓存今日图片信息
            cacheImageInfo(selectedImage, imageUrl);
            
            console.log('图片加载成功:', selectedImage);
          })(),
          timeoutPromise
        ]);
      } catch (error) {
        console.error('主题图片加载过程中出错:', error);
        
        // 显示占位图
        imgElement.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjQjBCMEIwIiBzdHJva2Utd2lkdGg9IjIiLz48dGV4dCB4PSI1MCIgeT0iNTUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzQ0NCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+6IO95LqM6YeN55+lPC90ZXh0Pjwvc3ZnPg==';
        imgElement.alt = '图片加载失败';
        
        // 错误分类和用户友好提示
        let errorMessage = '图片加载失败';
        let errorDetails = error.message || String(error);
        
        // 根据错误类型显示不同的错误信息
        if (errorDetails.includes('超时')) {
          errorMessage = '加载超时，请检查网络连接';
          errorDetails += '。可能是网络不稳定或GitHub服务器响应缓慢。';
        } else if (errorDetails.includes('未找到') || errorDetails.includes('404')) {
          errorMessage = '未找到可显示的图片';
          errorDetails += '。仓库中可能没有可用的主题图片。';
        } else if (errorDetails.includes('获取图片列表')) {
          errorMessage = '无法获取图片列表';
          errorDetails += '。可能是GitHub API限制或网络问题。';
        } else if (errorDetails.includes('图片列表格式')) {
          errorMessage = '图片列表数据异常';
          errorDetails += '。请刷新页面重试。';
        }
        
        // 显示错误信息和重试按钮
        captionElement.innerHTML = `
          <div style="color:var(--error); margin-bottom:8px;">${errorMessage}</div>
          <button onclick="showRandomTheme()" class="refresh-button" style="margin-top:10px; padding:6px 12px; background:#f0f0f0; border:1px solid #ddd; border-radius:4px; cursor:pointer;">
            <i class="fas fa-redo"></i> 重试
          </button>
          <div style="font-size:12px; color:#666; margin-top:8px; line-height:1.4;">错误详情: ${errorDetails}</div>
          <div style="font-size:11px; color:#888; margin-top:5px;">点击上方按钮尝试重新加载</div>
        `;
      }
      
      // 确保弹窗在最上层
      if (modal.style.zIndex === '' || parseInt(modal.style.zIndex) < 1000) {
        modal.style.zIndex = '1000';
        backdrop.style.zIndex = '999';
      }
    }
    
    // 隐藏主题弹窗
    function hideThemeModal() {
      document.getElementById('theme-modal').classList.remove('show');
      document.getElementById('theme-backdrop').classList.remove('show');
    }
    
    // 点击背景关闭弹窗
    document.getElementById('theme-backdrop').addEventListener('click', hideThemeModal);
    
    // 公告
    async function fetchAnnouncement() {
      const contentDiv = document.getElementById('announcement-content');
      
      // 添加null检查
      if (!contentDiv) {
        console.warn('公告元素不存在，跳过公告加载');
        return;
      }
      
      try {
        contentDiv.innerHTML = '<div class="loading-text"><i class="fas fa-spinner"></i> 加载中...</div>';
        const response = await fetch('https://raw.githubusercontent.com/Dxhmine/test/main/home.txt');
        if (!response.ok) throw new Error(`HTTP错误! 状态码: ${response.status}`);
        const text = await response.text();
        contentDiv.innerHTML = (text || '暂无公告').replace(/\n/g, '<br>');
      } catch (error) {
        // 再次检查contentDiv是否存在
        if (contentDiv) {
          contentDiv.innerHTML = `
            <div class="error-text">
              <i class="fas fa-exclamation-triangle"></i> ${escapeHtml(error.message)}
              <button onclick="fetchAnnouncement()" class="refresh-button" style="margin-top:10px;">
                <i class="fas fa-redo"></i> 重试
              </button>
            </div>
          `;
        } else {
          console.error('尝试更新不存在的公告元素:', error);
        }
      }
    }
    
    // 模态窗口公告获取
    async function fetchModalAnnouncement() {
      const contentDiv = document.getElementById('modal-announcement-content');
      
      // 添加null检查
      if (!contentDiv) {
        console.warn('模态公告元素不存在，跳过公告加载');
        return;
      }
      
      try {
        contentDiv.innerHTML = '<div class="loading-text"><i class="fas fa-spinner"></i> 加载中...</div>';
        const response = await fetch('https://raw.githubusercontent.com/Dxhmine/test/main/home.txt');
        if (!response.ok) throw new Error(`HTTP错误! 状态码: ${response.status}`);
        const text = await response.text();
        contentDiv.innerHTML = (text || '暂无公告').replace(/\n/g, '<br>');
      } catch (error) {
        // 再次检查contentDiv是否存在，以防DOM在try期间被修改
        if (contentDiv) {
          contentDiv.innerHTML = `
            <div class="error-text">
              <i class="fas fa-exclamation-triangle"></i> ${escapeHtml(error.message)}
              <button onclick="fetchModalAnnouncement()" class="refresh-button" style="margin-top:10px;">
                <i class="fas fa-redo"></i> 重试
              </button>
            </div>
          `;
        } else {
          console.error('尝试更新不存在的公告元素:', error);
        }
      }
    }
    
    // 切换公告模态窗口显示/隐藏
    function toggleAnnouncement() {
      const modal = document.getElementById('announcement-modal');
      const backdrop = document.getElementById('announcement-backdrop');
      
      // 添加null检查
      if (!modal || !backdrop) {
        console.warn('公告模态窗口元素不存在，无法切换显示状态');
        return;
      }
      
      // 切换显示状态
      modal.classList.toggle('show');
      backdrop.classList.toggle('show');
      
      // 如果是打开状态，加载公告内容
      if (modal.classList.contains('show')) {
        fetchModalAnnouncement();
      }
    }
    
    // 点击空白区域（背景遮罩）关闭公告
    document.addEventListener('DOMContentLoaded', function() {
      const backdrop = document.getElementById('announcement-backdrop');
      const modal = document.getElementById('announcement-modal');
      
      // 添加null检查
      if (!backdrop || !modal) {
        console.warn('公告模态窗口元素不存在，跳过事件监听器设置');
        return;
      }
      
      // 点击背景遮罩关闭公告
      backdrop.addEventListener('click', function(e) {
        if (e.target === backdrop) {
          toggleAnnouncement();
        }
      });
      
      // 点击ESC键关闭公告
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('show')) {
          toggleAnnouncement();
        }
      });
    });

    // 完整文件发布功能
    async function fetchReleases() {
      try {
        const response = await fetch('https://api.github.com/repos/Dxhmine/test/releases');
        if (!response.ok) throw new Error('获取发布信息失败');
        
        const releases = await response.json();
        const container = document.getElementById('releases');
        
        // 保存原始数据用于搜索
        allReleasesData = releases;
        
        // 对releases按标签进行分类
        const categorizedReleases = categorizeReleasesByTags(releases);
        
        // 保存分类数据用于搜索
        categorizedReleasesData = categorizedReleases;
        
        // 生成分类HTML
        container.innerHTML = generateCategoryHTML(categorizedReleases);

        // 更新统计信息
        document.getElementById('release-count').textContent = releases.length;
        const totalFiles = releases.reduce((acc, release) => acc + release.assets.length, 0);
        document.getElementById('file-count').textContent = totalFiles;

        // 添加切换资源显示的事件监听
        document.querySelectorAll('.toggle-assets').forEach(button => {
          button.addEventListener('click', function() {
            const assetsList = this.previousElementSibling;
            assetsList.style.display = assetsList.style.display === 'none' ? 'block' : 'none';
            this.innerHTML = assetsList.style.display === 'none' ? 
              '<i class="fas fa-layer-group"></i> 显示资源' : 
              '<i class="fas fa-layer-group"></i> 隐藏资源';
          });
        });
        
        // 添加分类折叠展开的事件监听
        document.querySelectorAll('.category-header').forEach(header => {
          header.addEventListener('click', function() {
            const content = this.nextElementSibling;
            content.classList.toggle('expanded');
            const icon = this.querySelector('.category-icon');
            icon.className = content.classList.contains('expanded') ? 
              'fas fa-chevron-down category-icon' : 
              'fas fa-chevron-right category-icon';
          });
        });
        
        // 默认展开所有分类
        setTimeout(() => {
          document.querySelectorAll('.category-header').forEach(header => {
            header.click();
          });
        }, 100);
        
        // 初始化搜索功能
        initSearch();
      } catch (error) {
        showErrorNotification(`文件加载失败: ${error.message}`);
      }
    }
    
    // 根据标签对releases进行分类
    function categorizeReleasesByTags(releases) {
      const categories = {};
      const defaultCategory = '其他';
      
      releases.forEach(release => {
        // 检测标签（从tag_name、name或body中提取）
        const tags = extractTags(release);
        
        if (tags.length > 0) {
          // 有标签的release放入对应的分类
          tags.forEach(tag => {
            if (!categories[tag]) {
              categories[tag] = [];
            }
            categories[tag].push(release);
          });
        } else {
          // 无标签的release放入默认分类
          if (!categories[defaultCategory]) {
            categories[defaultCategory] = [];
          }
          categories[defaultCategory].push(release);
        }
      });
      
      return categories;
    }
    
    // 从release中提取标签
    function extractTags(release) {
      const tags = [];
      const tagPattern = /#([a-zA-Z0-9_\u4e00-\u9fa5]+)/g;
      
      // 从多个字段中提取标签
      const fieldsToCheck = [
        release.tag_name || '',
        release.name || '',
        release.body || ''
      ];
      
      fieldsToCheck.forEach(field => {
        const matches = field.match(tagPattern);
        if (matches) {
          matches.forEach(match => {
            const tag = match.substring(1).toLowerCase();
            if (!tags.includes(tag)) {
              tags.push(tag);
            }
          });
        }
      });
      
      return tags;
    }
    
    // 生成分类HTML
    function generateCategoryHTML(categories) {
      const defaultCategory = '其他';
      let html = '';
      
      // 先处理非默认分类
      Object.keys(categories).forEach(categoryName => {
        if (categoryName !== defaultCategory) {
          html += generateCategoryHTMLSection(categoryName, categories[categoryName], false);
        }
      });
      
      // 最后处理默认分类（如果存在）
      if (categories[defaultCategory] && categories[defaultCategory].length > 0) {
        html += generateCategoryHTMLSection(defaultCategory, categories[defaultCategory], true);
      }
      
      return html || '<div class="empty-message">暂无发布内容</div>';
    }
    
    // 生成单个分类的HTML
    function generateCategoryHTMLSection(categoryName, releases, isDefault) {
      const categoryClass = isDefault ? 'release-category default-category' : 'release-category';
      
      return `
        <div class="${categoryClass}">
          <div class="category-header">
            <span>
              <i class="fas fa-chevron-right category-icon"></i>
              ${escapeHtml(categoryName)}
              <span class="category-count">${releases.length}</span>
            </span>
          </div>
          <div class="category-content">
            ${releases.map(release => `
              <div class="release">
                <div class="release-header">
                  <h3><i class="fas fa-tag"></i> ${escapeHtml(release.name)}</h3>
                  <div class="release-meta">
                    <span><i class="fas fa-tags"></i> 分类：${escapeHtml(release.tag_name)}</span>
                    <span><i class="fas fa-calendar-alt"></i> 发布时间：${new Date(release.published_at).toLocaleDateString()}</span>
                  </div>
                </div>
                <ul class="assets" style="display:none;">
                  ${release.assets.map(asset => `
                    <li class="download-item">
                      <div class="file-info">
                        <span class="file-name"><i class="fas fa-file"></i> ${escapeHtml(asset.name)}</span>
                        <span class="file-size"><i class="fas fa-database"></i> ${formatFileSize(asset.size)}</span>
                      </div>
                      <div class="download-options">
                        <a href="${asset.browser_download_url}" class="download-link">
                          <i class="fas fa-download"></i> 普通下载
                        </a>
                        <a href="${generateProxyUrl(asset.browser_download_url)}" 
                           class="download-link accelerated">
                          <i class="fas fa-bolt"></i> 高速下载
                        </a>
                      </div>
                    </li>
                  `).join('')}
                </ul>
                <button class="submit-button toggle-assets">
                  <i class="fas fa-layer-group"></i> 显示资源
                </button>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    // 获取并显示讨论区
    async function fetchDiscussions() {
      try {
        const response = await fetch('https://api.github.com/repos/Dxhmine/test/issues');
        const issues = await response.json();

        const container = document.getElementById('discussions');
        container.innerHTML = '';
        
        issues.forEach(issue => {
          const issueDiv = document.createElement('div');
          issueDiv.className = 'issue';
          issueDiv.innerHTML = `
            <div class="issue-header">
              <div class="user-info">
                <img src="${issue.user.avatar_url}" class="avatar" alt="${issue.user.login}">
                <div class="user-details">
                  <div class="comment-author">${issue.user.login}</div>
                  <div class="comment-date">${new Date(issue.created_at).toLocaleString()}</div>
                </div>
              </div>
              <h3><i class="fas fa-comment-dots"></i> ${issue.title}</h3>
              <p>${issue.body || '无内容描述'}</p>
              <button class="submit-button" onclick="loadComments(this, ${issue.number})"
                style="margin-top:15px;padding:10px 20px;">
                <i class="fas fa-comments"></i> 显示评论 (${issue.comments})
              </button>
            </div>
            <div class="comments-container" style="display:none;"></div>
          `;
          container.appendChild(issueDiv);
        });
      } catch (error) {
        console.error('获取讨论信息失败:', error);
        showErrorNotification('加载讨论失败，请稍后重试');
      }
    }

    // 加载评论
    async function loadComments(button, issueNumber) {
      const container = button.parentElement.nextElementSibling;
      if (container.children.length === 0) {
        try {
          button.disabled = true;
          button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 加载中...';
          
          const response = await fetch(`https://api.github.com/repos/Dxhmine/test/issues/${issueNumber}/comments`);
          const comments = await response.json();
          
          container.innerHTML = comments.map(comment => `
            <div class="comment">
              <img src="${comment.user.avatar_url}" class="avatar" alt="${comment.user.login}">
              <div class="comment-content">
                <div class="user-info">
                  <span class="comment-author">${comment.user.login}</span>
                  <span class="comment-date">${new Date(comment.created_at).toLocaleString()}</span>
                </div>
                <div class="comment-body">${comment.body || '无评论内容'}</div>
              </div>
            </div>
          `).join('');
          
          button.innerHTML = `<i class="fas fa-comments"></i> 隐藏评论 (${comments.length})`;
        } catch (error) {
          console.error('获取评论失败:', error);
          container.innerHTML = '<div class="error-text"><i class="fas fa-exclamation-triangle"></i> 无法加载评论</div>';
          button.innerHTML = `<i class="fas fa-comments"></i> 显示评论 (${issueNumber})`;
        } finally {
          button.disabled = false;
        }
      }
      container.style.display = container.style.display === 'none' ? 'block' : 'none';
      button.innerHTML = container.style.display === 'none' ? 
        `<i class="fas fa-comments"></i> 显示评论 (${issueNumber})` : 
        `<i class="fas fa-comments"></i> 隐藏评论 (${issueNumber})`;
    }

    // 创建Issue
    function createNewIssue() {
      const titleInput = document.getElementById('issueTitle');
      const bodyInput = document.getElementById('issueBody');
      
      if (!titleInput.value.trim()) {
        titleInput.focus();
        titleInput.style.borderColor = '#e74c3c';
        setTimeout(() => titleInput.style.borderColor = '#e0e0e0', 2000);
        showErrorNotification('请填写讨论标题');
        return;
      }

      const baseUrl = 'https://github.com/Dxhmine/test/issues/new';
      const params = new URLSearchParams({
        title: titleInput.value.trim(),
        body: bodyInput.value.trim(),
        labels: 'user-generated'
      });

      const newWindow = window.open(`${baseUrl}?${params.toString()}`, '_blank');
      
      if (newWindow) {
        titleInput.value = '';
        bodyInput.value = '';
        showSuccessNotification('讨论创建成功！请在GitHub页面完成提交');
      }
    }

    function escapeHtml(unsafe) {
      return unsafe.toString()
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function generateProxyUrl(url) {
      return `https://ghproxy.net/${encodeURI(url)}`;
    }

    // 搜索功能
    let allReleasesData = []; // 存储所有releases数据
    let categorizedReleasesData = {}; // 存储分类后的releases数据
    
    function initSearch() {
      const searchInput = document.getElementById('search-input');
      const clearSearchBtn = document.getElementById('clear-search');
      const originalContent = document.getElementById('original-content');
      const searchResults = document.getElementById('search-results');
      const resultsCount = document.getElementById('search-results-count');
      
      // 监听搜索输入
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.trim().toLowerCase();
        
        // 显示/隐藏清除按钮
        clearSearchBtn.style.display = searchTerm ? 'flex' : 'none';
        
        // 执行搜索
        if (searchTerm) {
          performSearch(searchTerm);
        } else {
          // 清空搜索时显示原始内容
          originalContent.style.display = 'block';
          searchResults.style.display = 'none';
          resultsCount.textContent = '';
        }
      });
      
      // 清除搜索
      clearSearchBtn.addEventListener('click', function() {
        searchInput.value = '';
        clearSearchBtn.style.display = 'none';
        originalContent.style.display = 'block';
        searchResults.style.display = 'none';
        resultsCount.textContent = '';
        searchInput.focus();
      });
    }
    
    function performSearch(searchTerm) {
      const searchResults = document.getElementById('search-results');
      const resultsCount = document.getElementById('search-results-count');
      const originalContent = document.getElementById('original-content');
      
      // 搜索结果存储
      const searchMatches = {};
      let totalMatches = 0;
      
      // 遍历所有分类
      Object.keys(categorizedReleasesData).forEach(categoryName => {
        const releases = categorizedReleasesData[categoryName];
        const categoryMatches = [];
        
        // 遍历该分类下的所有releases
        releases.forEach(release => {
          const releaseMatches = {
            release: release,
            assets: []
          };
          
          // 检查分类名是否匹配
          const categoryMatch = categoryName.toLowerCase().includes(searchTerm);
          
          // 检查release信息是否匹配
          const releaseMatch = (
            (release.name && release.name.toLowerCase().includes(searchTerm)) ||
            (release.tag_name && release.tag_name.toLowerCase().includes(searchTerm)) ||
            (release.body && release.body.toLowerCase().includes(searchTerm))
          );
          
          // 检查assets文件名是否匹配
          const matchingAssets = release.assets.filter(asset => 
            asset.name.toLowerCase().includes(searchTerm)
          );
          
          // 如果有匹配项，添加到结果
          if (categoryMatch || releaseMatch || matchingAssets.length > 0) {
            releaseMatches.assets = matchingAssets.length > 0 ? matchingAssets : release.assets;
            categoryMatches.push(releaseMatches);
            totalMatches += releaseMatches.assets.length;
          }
        });
        
        if (categoryMatches.length > 0) {
          searchMatches[categoryName] = categoryMatches;
        }
      });
      
      // 生成搜索结果HTML
      let html = '';
      
      if (Object.keys(searchMatches).length > 0) {
        // 有搜索结果
        Object.keys(searchMatches).forEach(categoryName => {
          const releases = searchMatches[categoryName];
          
          // 添加分类标题
          html += `<div class="search-result-category">${escapeHtml(categoryName)}</div>`;
          
          // 添加匹配的releases
           releases.forEach(({ release, assets }) => {
             html += `
               <div class="release">
                 <div class="release-header">
                   <h3><i class="fas fa-tag"></i> ${highlightText(escapeHtml(release.name), searchTerm)}</h3>
                   <div class="release-meta">
                     <span><i class="fas fa-tags"></i> 分类：${highlightText(escapeHtml(release.tag_name), searchTerm)}</span>
                     <span><i class="fas fa-calendar-alt"></i> 发布时间：${new Date(release.published_at).toLocaleDateString()}</span>
                   </div>
                 </div>
                 <ul class="assets" style="display:none;">
                   ${assets.map(asset => `
                     <li class="download-item">
                       <div class="file-info">
                         <span class="file-name"><i class="fas fa-file"></i> ${highlightText(escapeHtml(asset.name), searchTerm)}</span>
                         <span class="file-size"><i class="fas fa-database"></i> ${formatFileSize(asset.size)}</span>
                       </div>
                       <div class="download-options">
                         <a href="${asset.browser_download_url}" class="download-link">
                           <i class="fas fa-download"></i> 普通下载
                         </a>
                         <a href="${generateProxyUrl(asset.browser_download_url)}" 
                            class="download-link accelerated">
                           <i class="fas fa-bolt"></i> 高速下载
                         </a>
                       </div>
                     </li>
                   `).join('')}
                 </ul>
                 <button class="submit-button toggle-assets search-toggle-assets">
                   <i class="fas fa-layer-group"></i> 显示资源 (${assets.length})
                 </button>
               </div>
             `;
           });
        });
      } else {
        // 无搜索结果
        html = `
          <div class="no-results">
            <i class="fas fa-search"></i>
            <p>没有找到与 "${escapeHtml(searchTerm)}" 相关的文件</p>
            <p style="font-size:14px; margin-top:5px;">请尝试使用其他关键词搜索</p>
          </div>
        `;
      }
      
      // 更新显示
        searchResults.innerHTML = html;
        resultsCount.textContent = totalMatches > 0 ? `找到 ${totalMatches} 个匹配项` : '';
        originalContent.style.display = 'none';
        searchResults.style.display = 'block';
        
        // 为搜索结果中的切换按钮添加事件监听
        document.querySelectorAll('.search-toggle-assets').forEach(button => {
          button.addEventListener('click', function() {
            const assetsList = this.previousElementSibling;
            assetsList.style.display = assetsList.style.display === 'none' ? 'block' : 'none';
            const assetCount = this.textContent.match(/\d+/)[0];
            this.innerHTML = assetsList.style.display === 'none' ? 
              `<i class="fas fa-layer-group"></i> 显示资源 (${assetCount})` : 
              `<i class="fas fa-layer-group"></i> 隐藏资源 (${assetCount})`;
          });
        });
    }
    
    // 高亮搜索文本
    function highlightText(text, searchTerm) {
      if (!searchTerm) return text;
      
      const regex = new RegExp(`(${escapeRegExp(searchTerm)})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }
    
    // 转义正则表达式特殊字符
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function formatFileSize(bytes) {
      const units = ['Bytes', 'KB', 'MB', 'GB'];
      if (bytes == 0) return '0 Bytes';
      const exp = Math.floor(Math.log(bytes) / Math.log(1024));
      return `${(bytes / Math.pow(1024, exp)).toFixed(2)} ${units[exp]}`;
    }

    // 错误提示功能
    function showErrorNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'error-notification';
      notification.innerHTML = `
        <div class="error-content">
          <span><i class="fas fa-exclamation-circle"></i> ${escapeHtml(message)}</span>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
      `;
      document.body.appendChild(notification);
      notification.querySelector('.close-button').onclick = () => notification.remove();
      setTimeout(() => notification.remove(), 5000);
      
      // 样式
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.backgroundColor = '#ffebee';
      notification.style.color = '#c62828';
      notification.style.padding = '15px 25px';
      notification.style.borderRadius = '8px';
      notification.style.zIndex = '10000';
      notification.style.display = 'flex';
      notification.style.alignItems = 'center';
      notification.style.gap = '10px';
      
      const closeBtn = notification.querySelector('.close-button');
      closeBtn.style.background = 'none';
      closeBtn.style.border = 'none';
      closeBtn.style.cursor = 'pointer';
      closeBtn.style.color = '#c62828';
      closeBtn.style.fontSize = '1.2rem';
    }
    
    function showSuccessNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'success-notification';
      notification.innerHTML = `
        <div class="success-content">
          <span><i class="fas fa-check-circle"></i> ${escapeHtml(message)}</span>
          <button class="close-button"><i class="fas fa-times"></i></button>
        </div>
      `;
      document.body.appendChild(notification);
      notification.querySelector('.close-button').onclick = () => notification.remove();
      setTimeout(() => notification.remove(), 5000);
      
      // 样式
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.backgroundColor = '#e8f5e9';
      notification.style.color = '#2e7d32';
      notification.style.padding = '15px 25px';
      notification.style.borderRadius = '8px';
      notification.style.zIndex = '10000';
      notification.style.display = 'flex';
      notification.style.alignItems = 'center';
      notification.style.gap = '10px';
      
      const closeBtn = notification.querySelector('.close-button');
      closeBtn.style.background = 'none';
      closeBtn.style.border = 'none';
      closeBtn.style.cursor = 'pointer';
      closeBtn.style.color = '#2e7d32';
      closeBtn.style.fontSize = '1.2rem';
    }

    // 初始化
    document.addEventListener('DOMContentLoaded', initialize);
  </script>
<!-- 公告模态窗口 -->
  <div class="modal-backdrop" id="announcement-backdrop"></div>
  <div class="announcement-modal" id="announcement-modal">
    <div class="announcement-modal-header">
      <div class="announcement-modal-title"><i class="fas fa-bullhorn"></i> 公告</div>
      <button class="announcement-modal-close" onclick="toggleAnnouncement()"><i class="fas fa-times"></i></button>
    </div>
    <div class="announcement-modal-body" id="modal-announcement-content">
      <div class="loading-text"><i class="fas fa-spinner"></i> 加载公告中...</div>
    </div>
    <div class="announcement-modal-footer">
      <button class="refresh-button" onclick="fetchModalAnnouncement()"><i class="fas fa-sync-alt"></i> 刷新</button>
    </div>
  </div>
  </body>
</html>
